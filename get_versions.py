import solcx
import os
import re



versions = []


def find_solidity_version(Lines):
   for line in Lines:
      splitted = line.split(" ")
      if "pragma" in splitted :
         return splitted[2]
   

for filename in os.listdir("contracts"):
   with open(os.path.join("contracts", filename), 'r') as f: # open in readonly mode
      Lines = f.readlines()
      try :
         sv = find_solidity_version(Lines)
         if sv == None :
            continue
         sv = sv.strip()
         try:
            stop = sv.index(";")
            solcx.install_solc(version=sv[1:stop])
            print(f"Version {sv[1:stop]} is installed")
            print(f"SV is {sv}")
            versions.append(sv[1:stop])
         except:
            print(f"{sv} is failed")

         
      except:
         print(filename)
         continue

print(solcx.get_installed_solc_versions())
      





